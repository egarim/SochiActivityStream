@page "/"
@inherits MvvmComponentBase<HomeViewModel>
@inject ICurrentUserService CurrentUser
@inject NavigationManager Navigation
@rendermode InteractiveServer

<PageTitle>BlazorBook - Where Friends Connect</PageTitle>

@if (CurrentUser.IsAuthenticated)
{
    <Feed />
}
else
{
    <div class="sk-auth-container">
        <div class="text-center mb-5">
            <MudText Typo="Typo.h3" Class="auth-logo">
                <MudIcon Icon="@Icons.Material.Filled.MenuBook" Class="me-2" />BlazorBook
            </MudText>
            <MudText Typo="Typo.subtitle1" Class="mud-text-secondary">Connect with friends and the world around you.</MudText>
        </div>
        
        <MudCard Class="mx-auto" Style="max-width: 420px;" Elevation="2">
            <MudCardContent>
                <div class="p-4">
                    <MudText Typo="Typo.h5" Align="Align.Center" Class="mb-4">Welcome Back</MudText>
                    
                    <div class="d-grid gap-3">
                        <MudButton id="home-login-button"
                                   Color="Color.Primary"
                                   Variant="Variant.Filled"
                                   Size="Size.Large"
                                   FullWidth="true"
                                   OnClick="@(() => VM.NavigateToLoginCommand.ExecuteAsync(null))">
                            Log In
                        </MudButton>
                        
                        <MudDivider />
                        
                        <MudButton id="home-signup-button"
                                   Color="Color.Success"
                                   Variant="Variant.Filled"
                                   Size="Size.Large"
                                   FullWidth="true"
                                   OnClick="@(() => VM.NavigateToSignUpCommand.ExecuteAsync(null))">
                            Create New Account
                        </MudButton>
                    </div>
                </div>
            </MudCardContent>
        </MudCard>
        
        <div class="text-center mt-4">
            <MudText Typo="Typo.caption" Class="mud-text-secondary">
                Demo social network powered by Sochi.Navigation MVVM
            </MudText>
        </div>
    </div>
}

@code {
    protected override Task OnInitializedAsync()
    {
        if (CurrentUser.IsAuthenticated)
        {
            Navigation.NavigateTo("/feed", replace: true);
        }

        return base.OnInitializedAsync();
    }
}
