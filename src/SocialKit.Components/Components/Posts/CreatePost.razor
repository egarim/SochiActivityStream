@* Create Post Component using MudBlazor *@

<MudCard Class="sk-create-post mb-3" Elevation="2">
    <MudCardContent>
        <div class="d-flex align-items-start gap-2">
            <Avatar ImageUrl="@UserAvatar" 
                    Name="@UserName" 
                    Size="AvatarSize.Medium" />
            <MudTextField @bind-Value="@Text"
                          id="post-content"
                          Lines="2"
                          Variant="Variant.Outlined"
                          Placeholder="@($"What's on your mind, {FirstName}?")"
                          Disabled="@IsPosting"
                          Class="flex-grow-1" />
        </div>
    </MudCardContent>
    
    <MudDivider />
    
    <MudCardActions Class="d-flex justify-content-between px-3">
        <div class="d-flex gap-2">
            <MudButton StartIcon="@Icons.Material.Filled.Image"
                       Variant="Variant.Text"
                       Size="Size.Small"
                       Disabled="true">Photo/Video</MudButton>
            <MudButton StartIcon="@Icons.Material.Filled.PersonAdd"
                       Variant="Variant.Text"
                       Size="Size.Small"
                       Disabled="true">Tag</MudButton>
        </div>
        <MudButton id="post-button"
                   StartIcon="@Icons.Material.Filled.Send"
                   Color="Color.Primary"
                   Variant="Variant.Filled"
                   Size="Size.Small"
                   Disabled="@(!CanPost)"
                   OnClick="HandlePost">Post</MudButton>
    </MudCardActions>
</MudCard>

@code {
    [Parameter] public string? UserAvatar { get; set; }
    [Parameter] public string? UserName { get; set; }
    [Parameter] public EventCallback<string> OnPost { get; set; }
    [Parameter] public bool IsPosting { get; set; }
    
    private string Text { get; set; } = "";
    
    private string FirstName => UserName?.Split(' ').FirstOrDefault() ?? "friend";
    
    private bool CanPost => !string.IsNullOrWhiteSpace(Text) && !IsPosting;
    
    private async Task HandlePost()
    {
        if (!CanPost) return;
        
        var text = Text;
        Text = "";
        
        if (OnPost.HasDelegate)
            await OnPost.InvokeAsync(text);
    }
}
