@* Conversation Content Component - Single chat UI *@
@using SocialKit.Components.ViewModels

<div class="sk-conversation">
    <MudCard Class="h-100" Style="min-height:70vh;" Elevation="2">
        <MudCardHeader>
            <CardHeaderAvatar>
                <MudIconButton Icon="@Icons.Material.Filled.ArrowBack"
                               OnClick="@(() => ViewModel.GoBackCommand.ExecuteAsync(null))" />
            </CardHeaderAvatar>
            <CardHeaderContent>
                <MudText Typo="Typo.h6">@ViewModel.Title</MudText>
            </CardHeaderContent>
        </MudCardHeader>
        <MudCardContent>
            @if (ViewModel.IsBusy && ViewModel.Conversation == null)
            {
                <div class="text-center p-5">
                    <MudProgressCircular Indeterminate="true" />
                </div>
            }
            else
            {
                <div class="d-flex flex-column h-100" style="min-height:50vh;">
                    <!-- Messages Area -->
                    <div class="flex-grow-1 overflow-auto mb-3">
                        @if (ViewModel.Messages.Count == 0)
                        {
                            <div class="text-center p-5 mud-text-secondary">
                                <MudIcon Icon="@Icons.Material.Filled.Forum" Style="font-size:48px;" Class="mb-3" />
                                <MudText>No messages yet. Start the conversation!</MudText>
                            </div>
                        }
                        else
                        {
                            <div class="d-flex flex-column gap-2">
                                @foreach (var message in ViewModel.Messages)
                                {
                                    var isSent = message.Sender?.Id == ViewModel.CurrentUserId;
                                    <MessageBubble Message="@message"
                                                   IsSent="@isSent"
                                                   SenderName="@message.Sender?.DisplayName"
                                                   ShowAvatar="@(!isSent)" />
                                }
                            </div>
                        }
                    </div>
                    
                    <!-- Message Input -->
                    <div class="border-top pt-3">
                        <div class="d-flex gap-2">
                            <MudTextField @bind-Value="@ViewModel.NewMessageText"
                                          id="message-input"
                                          Placeholder="Type a message..."
                                          Variant="Variant.Outlined"
                                          Class="flex-grow-1" />
                            <MudButton id="send-message"
                                       StartIcon="@Icons.Material.Filled.Send"
                                       Color="Color.Primary"
                                       Variant="Variant.Filled"
                                       Disabled="@(!ViewModel.SendMessageCommand.CanExecute(null))"
                                       OnClick="@(() => ViewModel.SendMessageCommand.ExecuteAsync(null))">Send</MudButton>
                        </div>
                    </div>
                </div>
            }
        </MudCardContent>
    </MudCard>
</div>

@code {
    [Parameter, EditorRequired] public ConversationViewModel ViewModel { get; set; } = null!;
}
