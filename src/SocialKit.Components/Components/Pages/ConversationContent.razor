@* Conversation Content Component - Single chat UI *@
@using SocialKit.Components.ViewModels

<div class="sk-conversation">
    <DxCard CssClass="h-100" style="min-height:70vh;">
        <HeaderTemplate>
            <div class="d-flex align-items-center gap-2 p-3">
                <DxButton IconCssClass="fas fa-arrow-left"
                          RenderStyle="ButtonRenderStyle.Link"
                          RenderStyleMode="ButtonRenderStyleMode.Text"
                          Click="@(() => ViewModel.GoBackCommand.ExecuteAsync(null))" />
                <h5 class="mb-0">@ViewModel.Title</h5>
            </div>
        </HeaderTemplate>
        <BodyTemplate>
            @if (ViewModel.IsBusy && ViewModel.Conversation == null)
            {
                <div class="text-center p-5">
                    <DxLoadingPanel Visible="true" />
                </div>
            }
            else
            {
                <div class="d-flex flex-column h-100 p-3" style="min-height:50vh;">
                    <!-- Messages Area -->
                    <div class="flex-grow-1 overflow-auto mb-3">
                        @if (ViewModel.Messages.Count == 0)
                        {
                            <div class="text-center p-5 text-muted">
                                <i class="fas fa-comments fa-3x mb-3"></i>
                                <p>No messages yet. Start the conversation!</p>
                            </div>
                        }
                        else
                        {
                            <div class="d-flex flex-column gap-2">
                                @foreach (var message in ViewModel.Messages)
                                {
                                    var isSent = message.Sender?.Id == ViewModel.CurrentUserId;
                                    <MessageBubble Message="@message"
                                                   IsSent="@isSent"
                                                   SenderName="@message.Sender?.DisplayName"
                                                   ShowAvatar="@(!isSent)" />
                                }
                            </div>
                        }
                    </div>
                    
                    <!-- Message Input -->
                    <div class="border-top pt-3">
                        <div class="d-flex gap-2">
                            <DxTextBox @bind-Text="@ViewModel.NewMessageText"
                                       NullText="Type a message..."
                                       CssClass="flex-grow-1" />
                            <DxButton IconCssClass="fas fa-paper-plane"
                                      RenderStyle="ButtonRenderStyle.Primary"
                                      Enabled="@ViewModel.SendMessageCommand.CanExecute(null)"
                                      Click="@(() => ViewModel.SendMessageCommand.ExecuteAsync(null))" />
                        </div>
                    </div>
                </div>
            }
        </BodyTemplate>
    </DxCard>
</div>

@code {
    [Parameter, EditorRequired] public ConversationViewModel ViewModel { get; set; } = null!;
}
