@* Profile Content Component - Reusable profile UI *@
@using SocialKit.Components.ViewModels

<div class="sk-profile">
    @if (ViewModel.IsBusy && ViewModel.Profile == null)
    {
        <div class="text-center p-5">
            <MudProgressCircular Indeterminate="true" />
        </div>
    }
    else if (ViewModel.Profile != null)
    {
        <!-- Cover + Avatar -->
        <div class="sk-profile-cover position-relative" style="height:200px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:8px 8px 0 0;">
            <div class="position-absolute" style="bottom:-60px;left:50%;transform:translateX(-50%);">
                <Avatar ImageUrl="@ViewModel.Profile.AvatarUrl"
                        Name="@ViewModel.Profile.DisplayName"
                        Size="AvatarSize.XLarge"
                        CustomSize="120" />
            </div>
        </div>
        
        <!-- Profile Info -->
        <MudCard Class="pt-5 text-center" Style="border-radius:0 0 8px 8px;" Elevation="2">
            <MudCardContent>
                <div class="p-3 pt-4">
                    <MudText Typo="Typo.h5">@(ViewModel.Profile.DisplayName ?? ViewModel.Profile.Handle)</MudText>
                    <MudText Typo="Typo.body2" Class="mud-text-secondary">@@@ViewModel.Profile.Handle</MudText>
                    
                    <div class="d-flex justify-content-center gap-4 my-3">
                        <div class="text-center">
                            <MudText Typo="Typo.subtitle1" Class="fw-bold">@ViewModel.FollowerCount</MudText>
                            <MudText Typo="Typo.caption" Class="mud-text-secondary">Followers</MudText>
                        </div>
                        <div class="text-center">
                            <MudText Typo="Typo.subtitle1" Class="fw-bold">@ViewModel.FollowingCount</MudText>
                            <MudText Typo="Typo.caption" Class="mud-text-secondary">Following</MudText>
                        </div>
                        <div class="text-center">
                            <MudText Typo="Typo.subtitle1" Class="fw-bold">@ViewModel.Posts.Count</MudText>
                            <MudText Typo="Typo.caption" Class="mud-text-secondary">Posts</MudText>
                        </div>
                    </div>
                    
                    @if (!ViewModel.IsOwnProfile)
                    {
                        <div class="d-flex justify-content-center gap-2">
                            @if (ViewModel.IsFollowing)
                            {
                                <CommandButton Command="@ViewModel.UnfollowCommand" CssClass="btn btn-secondary">
                                    <MudIcon Icon="@Icons.Material.Filled.PersonRemove" Class="me-2" />Following
                                </CommandButton>
                            }
                            else
                            {
                                <CommandButton Command="@ViewModel.FollowCommand" CssClass="btn btn-primary">
                                    <MudIcon Icon="@Icons.Material.Filled.PersonAdd" Class="me-2" />Follow
                                </CommandButton>
                            }
                            <MudButton id="message-button"
                                       StartIcon="@Icons.Material.Filled.Message"
                                       Variant="Variant.Outlined">Message</MudButton>
                        </div>
                    }
                    else
                    {
                        <MudButton StartIcon="@Icons.Material.Filled.Edit"
                                   Variant="Variant.Outlined">Edit Profile</MudButton>
                    }
                </div>
            </MudCardContent>
        </MudCard>
        
        <!-- Posts Section -->
        <div style="max-width: 680px; margin: 24px auto 0;">
            @if (ViewModel.Posts.Count == 0)
            {
                <MudCard Class="text-center p-5" Elevation="2">
                    <MudCardContent>
                        <MudIcon Icon="@Icons.Material.Filled.Article" Style="font-size:48px;" Color="Color.Default" />
                        <MudText Typo="Typo.h6" Class="mt-3">No posts yet</MudText>
                        <MudText Typo="Typo.body2" Class="mud-text-secondary">
                            @if (ViewModel.IsOwnProfile)
                            {
                                <text>Share your first post with your friends!</text>
                            }
                            else
                            {
                                <text>@ViewModel.Profile.DisplayName hasn't posted anything yet.</text>
                            }
                        </MudText>
                    </MudCardContent>
                </MudCard>
            }
            else
            {
                @foreach (var post in ViewModel.Posts)
                {
                    <PostCard Post="@post"
                              OnLike="@(async (p) => { })"
                              OnComment="@(p => { })"
                              OnShare="@(p => { })" />
                }
            }
        </div>
    }
    else
    {
        <MudCard Class="text-center p-5" Elevation="2">
            <MudCardContent>
                <MudIcon Icon="@Icons.Material.Filled.PersonOff" Style="font-size:48px;" Color="Color.Default" />
                <MudText Typo="Typo.h6" Class="mt-3">Profile Not Found</MudText>
                <MudText Typo="Typo.body2" Class="mud-text-secondary">This profile doesn't exist or has been removed.</MudText>
            </MudCardContent>
        </MudCard>
    }
</div>

@code {
    [Parameter, EditorRequired] public ProfileViewModel ViewModel { get; set; } = null!;
}
