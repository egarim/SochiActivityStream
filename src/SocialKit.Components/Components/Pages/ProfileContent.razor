@* Profile Content Component - Reusable profile UI *@
@using SocialKit.Components.ViewModels

<div class="sk-profile">
    @if (ViewModel.IsBusy && ViewModel.Profile == null)
    {
        <div class="text-center p-5">
            <DxLoadingPanel Visible="true" />
        </div>
    }
    else if (ViewModel.Profile != null)
    {
        <!-- Cover + Avatar -->
        <div class="sk-profile-cover position-relative" style="height:200px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:8px 8px 0 0;">
            <div class="position-absolute" style="bottom:-60px;left:50%;transform:translateX(-50%);">
                <Avatar ImageUrl="@ViewModel.Profile.AvatarUrl"
                        Name="@ViewModel.Profile.DisplayName"
                        Size="AvatarSize.XLarge"
                        CustomSize="120" />
            </div>
        </div>
        
        <!-- Profile Info -->
        <DxCard CssClass="pt-5 text-center" style="border-radius:0 0 8px 8px;">
            <BodyTemplate>
                <div class="p-3 pt-4">
                    <h3>@(ViewModel.Profile.DisplayName ?? ViewModel.Profile.Handle)</h3>
                    <p class="text-muted">@@@ViewModel.Profile.Handle</p>
                    
                    <div class="d-flex justify-content-center gap-4 my-3">
                        <div class="text-center">
                            <div class="fw-bold">@ViewModel.FollowerCount</div>
                            <small class="text-muted">Followers</small>
                        </div>
                        <div class="text-center">
                            <div class="fw-bold">@ViewModel.FollowingCount</div>
                            <small class="text-muted">Following</small>
                        </div>
                        <div class="text-center">
                            <div class="fw-bold">@ViewModel.Posts.Count</div>
                            <small class="text-muted">Posts</small>
                        </div>
                    </div>
                    
                    @if (!ViewModel.IsOwnProfile)
                    {
                        <div class="d-flex justify-content-center gap-2">
                            @if (ViewModel.IsFollowing)
                            {
                                <CommandButton Command="@ViewModel.UnfollowCommand" CssClass="btn btn-secondary">
                                    <i class="fas fa-user-check me-2"></i>Following
                                </CommandButton>
                            }
                            else
                            {
                                <CommandButton Command="@ViewModel.FollowCommand" CssClass="btn btn-primary">
                                    <i class="fas fa-user-plus me-2"></i>Follow
                                </CommandButton>
                            }
                            <DxButton Text="Message"
                                      IconCssClass="fas fa-comment"
                                      RenderStyle="ButtonRenderStyle.Secondary" />
                        </div>
                    }
                    else
                    {
                        <DxButton Text="Edit Profile"
                                  IconCssClass="fas fa-edit"
                                  RenderStyle="ButtonRenderStyle.Secondary" />
                    }
                </div>
            </BodyTemplate>
        </DxCard>
        
        <!-- Posts Section -->
        <div style="max-width: 680px; margin: 24px auto 0;">
            @if (ViewModel.Posts.Count == 0)
            {
                <DxCard CssClass="text-center p-5">
                    <BodyTemplate>
                        <i class="fas fa-newspaper" style="font-size:48px;color:var(--sk-text-muted,#6c757d);"></i>
                        <h5 class="mt-3">No posts yet</h5>
                        <p class="text-muted">
                            @if (ViewModel.IsOwnProfile)
                            {
                                <text>Share your first post with your friends!</text>
                            }
                            else
                            {
                                <text>@ViewModel.Profile.DisplayName hasn't posted anything yet.</text>
                            }
                        </p>
                    </BodyTemplate>
                </DxCard>
            }
            else
            {
                @foreach (var post in ViewModel.Posts)
                {
                    <PostCard Post="@post"
                              OnLike="@(async (p) => { })"
                              OnComment="@(p => { })"
                              OnShare="@(p => { })" />
                }
            }
        </div>
    }
    else
    {
        <DxCard CssClass="text-center p-5">
            <BodyTemplate>
                <i class="fas fa-user-slash" style="font-size:48px;color:var(--sk-text-muted,#6c757d);"></i>
                <h5 class="mt-3">Profile Not Found</h5>
                <p class="text-muted">This profile doesn't exist or has been removed.</p>
            </BodyTemplate>
        </DxCard>
    }
</div>

@code {
    [Parameter, EditorRequired] public ProfileViewModel ViewModel { get; set; } = null!;
}
