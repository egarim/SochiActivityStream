@* Friends Content Component - Reusable friends list UI *@
@using SocialKit.Components.ViewModels

<div class="sk-friends" style="max-width: 1200px; margin: 0 auto;">
    <MudCard Elevation="2">
        <MudCardHeader>
            <CardHeaderContent>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <MudText Typo="Typo.h6"><MudIcon Icon="@Icons.Material.Filled.People" Class="me-2" />Friends</MudText>
                    <MudTextField T="string" id="friends-search" Placeholder="Search friends..." Style="max-width:300px;" Variant="Variant.Outlined" />
                </div>
                <MudTabs Elevation="0" Rounded="true" ApplyEffectsToContainer="true">
                    <MudTabPanel Text="@($"All Friends ({ViewModel.Friends.Count})")"
                                 OnClick="@(() => SetTab("friends"))" />
                    <MudTabPanel Text="@($"Followers ({ViewModel.Followers.Count})")"
                                 OnClick="@(() => SetTab("followers"))" />
                    <MudTabPanel Text="@($"Following ({ViewModel.Following.Count})")"
                                 OnClick="@(() => SetTab("following"))" />
                </MudTabs>
            </CardHeaderContent>
        </MudCardHeader>
        <MudCardContent>
            <div class="p-3">
                @if (ViewModel.IsBusy)
                {
                    <div class="text-center p-5">
                        <MudProgressCircular Indeterminate="true" />
                    </div>
                }
                else
                {
                    var displayList = ViewModel.SelectedTab switch
                    {
                        "followers" => ViewModel.Followers,
                        "following" => ViewModel.Following,
                        _ => ViewModel.Friends
                    };
                    
                    if (displayList.Count == 0)
                    {
                        <div class="text-center p-5">
                            <MudIcon Icon="@Icons.Material.Filled.PeopleOutline" Style="font-size:48px;" Color="Color.Default" />
                            <MudText Typo="Typo.h6" Class="mt-3">
                                @(ViewModel.SelectedTab == "friends" ? "No friends yet" : 
                                  ViewModel.SelectedTab == "followers" ? "No followers yet" : "Not following anyone")
                            </MudText>
                            <MudText Typo="Typo.body2" Class="mud-text-secondary">
                                @(ViewModel.SelectedTab == "friends" ? "Connect with people to build your network!" :
                                  ViewModel.SelectedTab == "followers" ? "Share great content to attract followers!" : "Follow people whose content you enjoy!")
                            </MudText>
                        </div>
                    }
                    else
                    {
                        <div class="row g-3">
                            @foreach (var friend in displayList)
                            {
                                <div class="col-6 col-md-4 col-lg-3">
                                    <FriendCard User="@friend"
                                               OnClick="@(async (u) => await ViewModel.ViewProfileCommand.ExecuteAsync(u))" />
                                </div>
                            }
                        </div>
                    }
                }
            </div>
        </MudCardContent>
    </MudCard>
</div>

@code {
    [Parameter, EditorRequired] public FriendsViewModel ViewModel { get; set; } = null!;
    
    private void SetTab(string tab)
    {
        ViewModel.SelectedTab = tab;
    }
}
