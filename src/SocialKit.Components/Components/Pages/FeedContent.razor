@* Feed Content Component - Reusable feed UI, used by page shells *@
@using SocialKit.Components.ViewModels

<div class="sk-feed" style="max-width: 680px; margin: 0 auto;">
    <!-- Create Post Box -->
    <CreatePost 
        UserName="@ViewModel.CurrentUserName"
        UserAvatar="@ViewModel.CurrentUserAvatar"
        OnPost="@HandleCreatePost"
        IsPosting="@ViewModel.CreatePostCommand.IsExecuting" />
    
    <!-- Posts -->
    @if (ViewModel.IsLoading)
    {
        <Skeleton Type="SocialKit.Components.Components.Common.SkeletonType.PostCard" />
        <Skeleton Type="SocialKit.Components.Components.Common.SkeletonType.PostCard" />
        <Skeleton Type="SocialKit.Components.Components.Common.SkeletonType.PostCard" />
    }
    else if (ViewModel.Posts.Count == 0)
    {
        <MudCard Class="text-center p-5" Elevation="2">
            <MudCardContent>
                <MudIcon Icon="@Icons.Material.Filled.Article" Style="font-size:48px;" Color="Color.Default" />
                <MudText Typo="Typo.h6" Class="mt-3">No posts yet</MudText>
                <MudText Typo="Typo.body2" Class="mud-text-secondary">Be the first to share something with your friends!</MudText>
            </MudCardContent>
        </MudCard>
    }
    else
    {
        @foreach (var post in ViewModel.Posts)
        {
            <PostCard 
                Post="@post"
                OnLike="@(async (p) => await ViewModel.LikePostCommand.ExecuteAsync(p))"
                OnComment="@(p => {})"
                OnShare="@(p => {})" />
        }
    }
</div>

@code {
    [Parameter, EditorRequired] public FeedViewModel ViewModel { get; set; } = null!;
    
    private async Task HandleCreatePost(string text)
    {
        ViewModel.NewPostText = text;
        await ViewModel.CreatePostCommand.ExecuteAsync(null);
    }
}
