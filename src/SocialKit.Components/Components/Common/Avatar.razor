@* Reusable Avatar component with fallback to initials *@

<div class="sk-avatar @SizeClass" style="@SizeStyle">
    @if (!string.IsNullOrEmpty(ImageUrl) && !_imageError)
    {
        <img src="@ImageUrl" 
             alt="@AltText" 
             class="sk-avatar-img"
             @onerror="OnImageError" />
    }
    else
    {
        <div class="sk-avatar-initials" style="background-color: @GetBackgroundColor();">
            @GetInitials()
        </div>
    }
    @if (ShowOnlineStatus && IsOnline)
    {
        <span class="sk-avatar-status online"></span>
    }
</div>

@code {
    [Parameter] public string? ImageUrl { get; set; }
    [Parameter] public string? Name { get; set; }
    [Parameter] public string? AltText { get; set; }
    [Parameter] public AvatarSize Size { get; set; } = AvatarSize.Medium;
    [Parameter] public int? CustomSize { get; set; }
    [Parameter] public bool ShowOnlineStatus { get; set; }
    [Parameter] public bool IsOnline { get; set; }
    
    private bool _imageError;
    
    private string SizeClass => Size switch
    {
        AvatarSize.XSmall => "sk-avatar-xs",
        AvatarSize.Small => "sk-avatar-sm",
        AvatarSize.Medium => "sk-avatar-md",
        AvatarSize.Large => "sk-avatar-lg",
        AvatarSize.XLarge => "sk-avatar-xl",
        _ => "sk-avatar-md"
    };
    
    private string SizeStyle => CustomSize.HasValue 
        ? $"--sk-avatar-size: {CustomSize}px;" 
        : "";
    
    private void OnImageError()
    {
        _imageError = true;
        StateHasChanged();
    }
    
    private string GetInitials()
    {
        if (string.IsNullOrWhiteSpace(Name))
            return "?";
        
        var parts = Name.Trim().Split(' ', StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length >= 2)
            return $"{parts[0][0]}{parts[^1][0]}".ToUpperInvariant();
        if (parts.Length == 1 && parts[0].Length >= 2)
            return parts[0][..2].ToUpperInvariant();
        if (parts.Length == 1)
            return parts[0][0].ToString().ToUpperInvariant();
        
        return "?";
    }
    
    private string GetBackgroundColor()
    {
        if (string.IsNullOrWhiteSpace(Name))
            return "#6c757d";
        
        var colors = new[]
        {
            "#1877f2", "#42b72a", "#f02849", "#1da1f2", 
            "#6c5ce7", "#00cec9", "#e17055", "#fdcb6e",
            "#0984e3", "#00b894", "#e84393", "#6c5ce7"
        };
        
        var hash = Name.GetHashCode();
        return colors[Math.Abs(hash) % colors.Length];
    }
}
